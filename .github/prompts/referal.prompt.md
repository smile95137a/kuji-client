# 推薦碼（Referral Code）機制需求文件

## 1. 需求背景與目的

為鼓勵店家主動推廣平台、協助引導新會員註冊，平台提供「推薦碼（Referral Code）」機制。

透過推薦碼：
- 新會員可於註冊時填寫推薦碼
- 系統可追蹤推薦關係
- 平台未來可依推薦成效給予店家 Bonus 或其他回饋

本機制僅作為 **紀錄與統計依據**，不即時影響抽獎、金流或訂單流程。

---

## 2. 推薦碼基本定義

### 2.1 推薦碼性質

- 推薦碼為「店家專屬」
- 每個店家至少擁有一組推薦碼
- 推薦碼由平台（Admin）建立與管理
- 推薦碼為「文字 / 英數混合」格式（實作細節後定）

---

### 2.2 推薦對象

- 僅適用於「新註冊會員」
- 僅能於 **註冊當下填寫**
- 註冊完成後，不可補填、不可修改

---

## 3. 推薦碼與會員註冊流程整合（前台）

### 3.1 會員註冊流程調整

在原有會員註冊流程中，新增欄位：

- 推薦碼（非必填）

流程說明：

1. 使用者進入會員註冊頁
2. 填寫基本註冊資料
3. （可選）填寫推薦碼
4. 系統驗證推薦碼是否有效
5. 完成會員註冊

---

### 3.2 推薦碼驗證規則

- 若推薦碼不存在 → 顯示錯誤提示
- 若推薦碼有效 → 成功綁定推薦關係
- 若未填寫推薦碼 → 正常註冊，不產生推薦關係

---

## 4. 推薦關係紀錄規則（核心）

當會員成功使用推薦碼註冊時，系統需紀錄以下資訊：

- 被推薦會員（新註冊會員）
- 推薦來源店家
- 使用的推薦碼
- 推薦發生時間（註冊時間）

此推薦關係：
- 為 **一次性紀錄**
- 不可變更
- 不可轉移

---

## 5. 推薦碼與店家管理關聯

### 5.1 店家層級關聯

- 每個推薦碼必須明確對應至單一店家
- 推薦碼不可跨店家共用
- 若店家被停用，其推薦碼不可再使用

---

### 5.2 店家後台可見資訊（未來擴充）

店家後台（StoreOwner）未來可查看：

- 使用該店家推薦碼註冊的會員數
- 推薦發生時間列表
- 累計推薦成效（僅顯示，不可操作）

（是否開放由 Admin 控制）

---

## 6. 推薦碼與 Bonus / 分潤規劃（預留）

目前階段僅需 **完整紀錄推薦行為**，不即時計算獎勵。

未來可基於以下條件進行 Bonus 計算：

- 被推薦會員是否完成抽獎
- 是否產生訂單
- 訂單金額
- 活躍度條件

本文件僅定義資料來源與關聯，不定義實際分潤規則。

---

## 7. 權限與管理規則

### 7.1 管理權限

- 僅 Admin 可：
  - 建立推薦碼
  - 停用推薦碼
  - 查詢全站推薦數據

- 店家不可自行建立或修改推薦碼

---

### 7.2 安全與防作弊規則

- 推薦碼僅能於註冊時使用
- 不可重複綁定
- 不可自行輸入自己的推薦碼
- 不可補登、不可修改

---

## 8. 與既有模組的影響說明（重要）

### 8.1 會員模組影響

- 註冊流程需新增「推薦碼」欄位
- 會員資料需能查詢推薦來源（僅系統內部）

---

### 8.2 店家管理模組影響

- 店家需具備「推薦碼」概念
- 店家狀態影響推薦碼可用性

---

### 8.3 抽獎 / 訂單模組影響

- 抽獎流程不受推薦碼影響
- 訂單流程不受推薦碼影響
- 僅作為後續統計與分析依據

---

## 9. 設計原則總結

- 推薦碼為輔助推廣工具，不影響核心交易流程
- 記錄清楚、不可逆
- 權限集中於 Admin
- 為未來 Bonus / 分潤保留完整依據
